<section class="container-wrapper">
  <header class="header">
    <div class="header-content">
      <h2>BaaS</h2>
      <p class="header-description">Aqui estão todos os BaaS configurados. Você pode selecionar qual deles estará ativo no gateway.</p>
    </div>
    <app-user-menu [username]="'Admin'" [email]="'admin@orbeey.com'" [saldo]="0" [saldoProtesto]="0" />
  </header>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <app-summary-card class="width-max" title="Total de Serviços" 
      [value]="metrics.totalServices.value.toString()" 
      [delta]="metrics.totalServices.delta" 
      [deltaType]="metrics.totalServices.deltaType" 
      icon="pi pi-server">
    </app-summary-card>
    
    <app-summary-card class="width-max" title="Serviços Ativos" 
      [value]="metrics.activeServices.value.toString()" 
      [delta]="metrics.activeServices.delta" 
      [deltaType]="metrics.activeServices.deltaType" 
      icon="pi pi-check-circle">
    </app-summary-card>
    
    <app-summary-card class="width-max" title="Requisições Totais" 
      [value]="formatNumber(metrics.totalRequests.value)" 
      [delta]="metrics.totalRequests.delta" 
      [deltaType]="metrics.totalRequests.deltaType" 
      icon="pi pi-chart-bar">
    </app-summary-card>
    
    <app-summary-card class="width-max" title="Custo Total" 
      [value]="formatCurrency(metrics.totalCost.value)" 
      [delta]="metrics.totalCost.delta" 
      [deltaType]="metrics.totalCost.deltaType" 
      icon="pi pi-dollar">
    </app-summary-card>
  </div>

  <!-- Filter Tabs -->
  <app-filter-tabs 
    [tabs]="[
      { label: 'Todos', value: '' },
      { label: 'Banking', value: 'banking' },
      { label: 'Pagamentos', value: 'payment' },
      { label: 'Identidade', value: 'identity' },
      { label: 'Crédito', value: 'credit' },
      { label: 'Investimentos', value: 'investment' },
      { label: 'Seguros', value: 'insurance' }
    ]" 
    [selected]="filters.category" 
    (selectedChange)="setCategory($event)"
    [search]="filters.search"
    (searchChange)="filters.search = $event"
    searchPlaceholder="Buscar serviços BaaS..."
    (filterClick)="sidebarVisible = true">
  </app-filter-tabs>

  <!-- Action Bar -->
  <div class="action-bar">
    <div class="results-info">
      <span>{{ filteredServices.length }} serviços encontrados</span>
    </div>
    <div class="action-buttons">
      <button class="btn-primary" (click)="openAddService()">
        <i class="pi pi-plus"></i>
        Adicionar Serviço
      </button>
    </div>
  </div>

  <!-- Services Grid -->
  <div class="services-grid">
    <div *ngFor="let service of pageServices" class="service-card">
      <div class="card-header">
        <div class="service-info">
          <h3 class="service-name">{{ service.name }}</h3>
          <p class="using-since">USANDO O BAAS DESDE</p>
          <p class="since-date">{{ formatDate(service.usingSince) }}</p>
        </div>
      </div>

      <div class="card-logo">
        <img [src]="service.logo" [alt]="service.name" class="service-logo">
      </div>

      <div class="card-footer">
        <div class="status-section">
          <label class="toggle-switch">
            <input type="checkbox" [checked]="service.status === 'active'" 
                   (change)="toggleServiceStatus()">
            <span class="slider"></span>
          </label>
          <span class="status-label">Ativo</span>
        </div>
        
        <button class="btn-actions" (click)="openServiceDetail(service)">
          Ações
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredServices.length === 0" class="empty-state">
    <i class="pi pi-server"></i>
    <h3>Nenhum serviço encontrado</h3>
    <p>Tente ajustar os filtros ou adicionar um novo serviço BaaS</p>
    <button class="btn-primary" (click)="clearFilters()">Limpar Filtros</button>
  </div>

  <!-- Pagination -->
  <orb-pagination 
    [currentPage]="currentPage" 
    [totalPages]="totalPages" 
    (pageChange)="goToPage($event)">
  </orb-pagination>

  <!-- Sidebar Filters -->
  <app-sidebar-filters [class.open]="sidebarVisible" [(visible)]="sidebarVisible" width="380px">
    <h3 header>Filtros Avançados</h3>

    <section class="drawer-content">
      <!-- Status Filter -->
      <div class="field">
        <span class="caption">Status</span>
        <select [(ngModel)]="filters.status">
          <option value="">Todos os status</option>
          <option value="active">Ativo</option>
          <option value="inactive">Inativo</option>
          <option value="maintenance">Manutenção</option>
          <option value="deprecated">Descontinuado</option>
        </select>
      </div>

      <!-- Provider Filter -->
      <div class="field">
        <span class="caption">Provedor</span>
        <input type="text" [(ngModel)]="filters.provider" placeholder="Nome do provedor">
      </div>

      <!-- Environment Filter -->
      <div class="field">
        <span class="caption">Ambiente</span>
        <select [(ngModel)]="filters.environment">
          <option value="">Todos os ambientes</option>
          <option value="production">Produção</option>
          <option value="sandbox">Sandbox</option>
          <option value="development">Desenvolvimento</option>
        </select>
      </div>

      <!-- Compliance Filter -->
      <div class="field">
        <span class="caption">Compliance</span>
        <input type="text" [(ngModel)]="filters.compliance" placeholder="Ex: LGPD, PCI DSS">
      </div>

      <!-- Cost Range -->
      <div class="field">
        <span class="caption">Custo Mensal</span>
        <div class="range-inputs">
          <input type="number" [(ngModel)]="filters.minCost" placeholder="Mínimo" min="0">
          <span>até</span>
          <input type="number" [(ngModel)]="filters.maxCost" placeholder="Máximo" min="0">
        </div>
      </div>

      <!-- Date Range -->
      <div class="field">
        <span class="caption">Data de Criação</span>
        <div class="date-range">
          <input type="date" [(ngModel)]="filters.dateFrom">
          <span>até</span>
          <input type="date" [(ngModel)]="filters.dateTo">
        </div>
      </div>
    </section>

    <div footer class="drawer-footer">
      <button class="btn-primary" (click)="sidebarVisible = false">Aplicar Filtros</button>
      <button class="btn-text" (click)="clearFilters()">Limpar Tudo</button>
    </div>
  </app-sidebar-filters>

  <!-- Service Detail Dialog -->
  <app-custom-dialog
    [(visible)]="serviceDetailVisible"
    [title]="'Detalhes do Serviço: ' + (selectedService?.name || '')"
    [actions]="[
      {id:'configure', label:'Configurar', type:'primary'},
      {id:'toggle_service', label: selectedService?.status === 'active' ? 'Desativar' : 'Ativar', type:'text'},
      {id:'close', label:'Fechar', type:'text'}
    ]"
    (action)="handleDialogAction($event)"
    width="1200px"
    maxHeight="90vh">
    
    <div *ngIf="selectedService" class="service-detail">
      <!-- Basic Info -->
      <div class="detail-section">
        <h4>Informações Básicas</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="label">Nome:</span>
            <span class="value">{{ selectedService.name }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Provedor:</span>
            <span class="value">{{ selectedService.provider }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Categoria:</span>
            <span class="value">{{ getCategoryLabel(selectedService.category) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Status:</span>
            <span class="badge" [ngClass]="getStatusClass(selectedService.status)">
              {{ getStatusLabel(selectedService.status) }}
            </span>
          </div>
          <div class="detail-item">
            <span class="label">Versão:</span>
            <span class="value">{{ selectedService.version }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Ambiente:</span>
            <span class="value">{{ selectedService.environment | titlecase }}</span>
          </div>
        </div>
      </div>

      <!-- API Configuration -->
      <div class="detail-section">
        <h4>Configuração da API</h4>
        <div class="api-config">
          <div class="config-item">
            <span class="config-label">Base URL:</span>
            <span class="config-value">{{ selectedService.api.baseUrl }}</span>
          </div>
          <div class="config-item">
            <span class="config-label">Versão:</span>
            <span class="config-value">{{ selectedService.api.version }}</span>
          </div>
          <div class="config-item">
            <span class="config-label">Autenticação:</span>
            <span class="config-value">{{ selectedService.api.authentication | uppercase }}</span>
          </div>
          <div class="config-item">
            <span class="config-label">Rate Limit:</span>
            <span class="config-value">{{ selectedService.api.rateLimit.requests }}/{{ selectedService.api.rateLimit.period }}</span>
          </div>
          <div class="config-item">
            <span class="config-label">Timeout:</span>
            <span class="config-value">{{ selectedService.api.timeout }}ms</span>
          </div>
          <div class="config-item">
            <span class="config-label">Retries:</span>
            <span class="config-value">{{ selectedService.api.retries }}</span>
          </div>
        </div>
      </div>

      <!-- Metrics -->
      <div class="detail-section">
        <h4>Métricas de Performance</h4>
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-label">Requisições Totais</div>
            <div class="metric-value">{{ formatNumber(selectedService.metrics.totalRequests) }}</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Taxa de Sucesso</div>
            <div class="metric-value">{{ formatPercentage((selectedService.metrics.successfulRequests / selectedService.metrics.totalRequests) * 100) }}</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Uptime</div>
            <div class="metric-value">{{ formatPercentage(selectedService.metrics.uptime) }}</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Tempo de Resposta</div>
            <div class="metric-value">{{ formatResponseTime(selectedService.metrics.averageResponseTime) }}</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Taxa de Erro</div>
            <div class="metric-value">{{ formatPercentage(selectedService.metrics.errorRate) }}</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Custo Total</div>
            <div class="metric-value">{{ formatCurrency(selectedService.metrics.totalCost) }}</div>
          </div>
        </div>
      </div>

      <!-- Features -->
      <div class="detail-section">
        <h4>Funcionalidades</h4>
        <div class="features-list">
          <div *ngFor="let feature of selectedService.features; let i = index" class="feature-item">
            <div class="feature-info">
              <div class="feature-name">{{ feature.name }}</div>
              <div class="feature-description">{{ feature.description }}</div>
            </div>
            <div class="feature-cost">{{ formatCurrency(feature.cost) }}</div>
            <div class="feature-toggle">
              <label class="toggle-switch">
                <input type="checkbox" [checked]="feature.enabled" (change)="toggleFeature(selectedService, i)">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Security & Compliance -->
      <div class="detail-section">
        <h4>Segurança e Compliance</h4>
        <div class="security-info">
          <div class="security-item">
            <span class="security-label">Criptografia:</span>
            <span class="security-value">{{ selectedService.security.encryption }}</span>
          </div>
          <div class="security-item">
            <span class="security-label">Localização dos Dados:</span>
            <span class="security-value">{{ selectedService.security.dataLocation }}</span>
          </div>
          <div class="security-item">
            <span class="security-label">Backup:</span>
            <span class="security-value">{{ selectedService.security.backupFrequency }}</span>
          </div>
        </div>
        
        <div class="compliance-badges">
          <h5>Compliance:</h5>
          <div class="badges-list">
            <span *ngFor="let compliance of selectedService.security.compliance" class="compliance-badge">
              {{ compliance }}
            </span>
          </div>
        </div>
        
        <div class="certification-badges">
          <h5>Certificações:</h5>
          <div class="badges-list">
            <span *ngFor="let cert of selectedService.security.certifications" class="certification-badge">
              {{ cert }}
            </span>
          </div>
        </div>
      </div>

      <!-- Support -->
      <div class="detail-section">
        <h4>Informações de Suporte</h4>
        <div class="support-info">
          <div class="support-item">
            <i class="pi pi-star"></i>
            <span>Nível: {{ selectedService.support.level | titlecase }}</span>
          </div>
          <div class="support-item">
            <i class="pi pi-envelope"></i>
            <span>{{ selectedService.support.email }}</span>
          </div>
          <div *ngIf="selectedService.support.phone" class="support-item">
            <i class="pi pi-phone"></i>
            <span>{{ selectedService.support.phone }}</span>
          </div>
          <div class="support-item">
            <i class="pi pi-book"></i>
            <a [href]="selectedService.support.documentation" target="_blank">Documentação</a>
          </div>
          <div class="support-item">
            <i class="pi pi-shield"></i>
            <span>SLA: {{ selectedService.support.sla }}</span>
          </div>
          <div class="support-item">
            <i class="pi pi-clock"></i>
            <span>Tempo de Resposta: {{ selectedService.support.responseTime }}</span>
          </div>
        </div>
      </div>
    </div>
  </app-custom-dialog>
</section>
